import { createDeepSeek } from '@ai-sdk/deepseek';
import { generateObject, streamText } from 'ai';
import z from 'zod';
import { TestString } from '../test';
import { env } from './utils/env';


const prompt = `
Задача:
Ты получаешь HTML-код страницы с текстом песни и аккордами. Твоя задача — извлечь текст песни, расставить аккорды над соответствующими словами, сохранив оригинальное форматирование (пробелы, табы, переносы строк).

Требования:
Извлечение аккордов:

Найди все аккорды (обычно в тегах <span class="chord">, <b>, или других, содержащих буквенно-цифровые обозначения, например, C#m, Am, G7).

Сохрани их позицию над текстом, не смещая строки.

Форматирование текста:

Оставь пробелы и табы перед аккордами (например, если аккорд сдвинут, сохрани этот отступ).

Переносы строк должны быть такими же, как в оригинале.

Структура вывода:

Аккорды пиши над строками, к которым они относятся.

Если аккорд стоит над пустым местом (например, перед началом куплета), оставь пробелы.

Сохрани все пояснения вроде [Припев], [Куплет], (бой: шестёрка) и т. д.

Если аккорды не найдены, выведи только текст с сохранением форматирования.

Если HTML некорректный, попробуй извлечь текст вручную, сохраняя структуру.

Финальный вывод должен быть чистым, читаемым и готовым для использования музыкантами.

Так же тебе надо найти название песни, исполнителя и BPM.

Если BPM не найден, оставь его пустым.

Если исполнитель не найден, оставь его пустым.

Если название песни не найдено, оставь его пустым.

Ответ должен быть текстом. следуй этому формату:

#[artist] - [song_name]
BPM: [BPM]
Паттерн гитары: [guitar_strumming]

\`\`\`chords
<chords_with_song>
\`\`\`

конец формата;

Данные для обрботки:
   `;

const deepseek = createDeepSeek({
  apiKey: env.DEEPSEEK_TOKEN,
});

export async function getChords(text: string) {
  return streamText({
    model: deepseek('deepseek-chat'),
    prompt: prompt + "\n\n" + text,
  });
}


export async function TestStream(text: string) {
  return streamText({
    model: deepseek('deepseek-chat'),
    prompt: text,
  });
}

